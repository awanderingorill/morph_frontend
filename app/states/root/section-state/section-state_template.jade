//- Project Modal
.project-modal.scrollable( ui-view='project-content' )

.sub-sort-wrapper( ng-if='stateParams.sortingType && "awards, media, type".indexOf( stateParams.sortingType ) != -1' )
	.sub-sort(
		ng-click='switchSubSort( "title" )'
		ng-class='subSort === "title"?"active-sort":""'
	)
		| A-Z
	.sub-sort(
		ng-click='switchSubSort( "date" )'
		ng-class='{ "active-sort": "year, superdate, pub_date".indexOf( subSort ) != -1 }'
	)
		| Date

.index-project-wrapper( ng-if='!altIndexSection && stateParams.sortingType && stateParams.sortingType !== "location"' )

	//- Items with 'section' attribute
	.index-project(
		ng-repeat='item in indexContents | filter: { section: { title: stateParams.section} } | sortingType: stateParams.sortingType:stateParams.q | orderBy: subSort: reverseVar'
		ng-if='item.section && item[subSort]'
		ui-sref='root.section-state.project-state( { projectId: item.id } )'
	)
		.project-image( preload-bg-image='{{ item.image.name.mobile.url }}' )

		.project-title( ng-bind-html='item.title || item.name | htmlParse' )

	//- Items without 'section' attribute
	.index-project(
		ng-repeat='item in indexContents'
		ng-if='!item.section'
		ui-sref='root.section-state.project-state( { projectId: item.id } )'

	)
		.project-image( preload-bg-image='{{ item.image.name.mobile.url }}' )

		.project-title( ng-bind-html='item.title || item.name | htmlParse' )

//- Alternate index
.alt-index-project-wrapper( ng-if='altIndexSection && ( stateParams.sortingType || stateParams.section == "news" || stateParams.section == "search" )' )

	.alt-index-project(
		ng-repeat='item in indexContents | sortingType: stateParams.sortingType:stateParams.q | orderBy: subSort : reverseVar'
		id='{{ item.uid }}'
		ng-if='item[subSort] || stateParams.section === "search"'
		ng-click='stateParams.section === "search" ? resolveSearchClick( item ) : expandProject( item.uid )'
	)

		//- 'Expand'/'Contract' buttons (+/-)
		.alt-index-expand(
			ng-if='item.description.length > 0 && stateParams.section !== "search"'
		)
			| {{ stateParams.e == item.id ? "-":"+" }}

		//- Project title and image
		.alt-project-title-and-image( ng-class='{ "expanded": stateParams.e && stateParams.e == item.id }' )

			//- Image
			img.alt-project-image(
				preload-image
				ng-if='item.image.name.mobile.url || item.image'
				ng-src='{{item.image.name.mobile.url || item.image }}'
			)

			//- Title + expanded sections
			.alt-title-and-expanded-wrapper( ng-class='{ "with-image": item.image.name.mobile.url || item.image }' )

				//- NOT search section (different ui-sref behavior)
				.alt-project-title(
					ng-bind-html='item.title || item.name | htmlParse'
					ng-if='stateParams.section !== "search"'
					ui-sref='root.section-state.sorting-state({ e: item.id })'
				)

				//- Search section click routing
				.project-detail-label( ng-if='stateParams.section === "search"' )
					| {{ item.section }} {{ item.sorting_type ? ' / ' + item.sorting_type : ''}}
				.alt-project-title(
					ng-bind-html='item.title || item.name | htmlParse'
					ng-if='stateParams.section === "search"'
				)

				.item-year( ng-if='item.year' )
					| ({{ item.year }})

				//- Overview attribute
				.alt-project-expanded( ng-bind-html='item.overview | htmlParse' )

				//- Bibliography citations + PDF
				.alt-project-expanded( ng-if='item.types && item.types.indexOf( "Bibliography" ) != -1' )
					| {{ item.author }}
					| {{ item.publication ? item.publication + '.' : '' }}
					| {{ item.publisher }}
					| {{ item.pub_date ? '(' + item.pub_date + ').' : '' }}
					| {{ item.pages ? item.pages + '.' : '' }}
					.pdf-attachment(
						ng-repeat='document in item.documents'
						ng-if='item.documents.length != 0'
					)
						a(
							href='{{ document.name.url }}'
							target='new'
						)
							| PDF

				//- Description attribute
				.alt-project-expanded(
					ng-if='stateParams.e && stateParams.e == item.id && ( item.description.length > 0 )'
					ng-bind-html='item.description | htmlParse'
				)

		//- Awards metadata
		.alt-project-metadata
			.alt-project-awarded( ng-if='stateParams.sortingType == "awards" && item.projects.length' )
				.alt-project-awarded-label.project-detail-label
					| {{ item.projects.length > 1 ? "Projects Awarded":"Project Awarded" }}:
				.alt-project-awarded-project(
					ng-repeat='project in item.projects'
					ui-sref='root.section-state.project-state({ section: "architecture",  projectId: project.id })'
				)
					| {{ project.title }}

.location-index-wrapper( ng-if='stateParams.sortingType === "location"' )
	leaflet(
		lf-center='center'
		markers='markers'
		layers='layers'
	)
